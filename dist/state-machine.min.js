/* state-machine 26-09-2013 */
!function(a,b){"function"==typeof define&&define.amd?define(function(){return a(b)}):"object"==typeof module&&module&&module.exports?module.exports=a(b):"object"==typeof exports&&exports?exports.StateMachine=a(b):b.StateMachine=a(b)}(function(){"use strict";var a=function(a,b){this._states=b||a,void 0===b&&(a="none"),this._history=[a],this._index=0,this._queue=[]};return a.prototype.transition=function(a){this.cant(a)||this._index===this._history.length-1&&(this._history.push(a),this._index+=1)},a.prototype.defer=function(a){this._queue.length?this._queue.push(a):this.transition(a)},a.prototype.is=function(a){return this.current()===a},a.prototype.isnt=function(a){return this.current()!==a},a.prototype.can=function(a){var b=this.current();if("none"===b&&!("none"in this._states))return!0;var c=this._states[b],d="!"+a,e=!1;if(void 0===c)return e;if(0===c.length)return e;for(var f=c.length;f--;){var g=c[f];if("*"===g||g===a)e=!0;else if(g===d)return!1}return e},a.prototype.cant=function(a){return!this.can(a)},a.prototype.current=function(){return this.at(this._index)},a.prototype.previous=function(a){return void 0===a&&(a=1),this.at(this._index-1*a)},a.prototype.next=function(a){return void 0===a&&(a=1),this.at(this._index+1*a)},a.prototype.at=function(a){return 0>a||a>=this._history.length?null:this._history[a]},a.prototype.back=function(){this.goto(this._index-1)},a.prototype.forward=function(){this.goto(this._index+1)},a.prototype.goto=function(a){var b,c=a-this._index;if(0!==c)for(c>0?b=1:(b=-1,c*=-1);c--;){var d=this.at(this._index+b);this.cant(d)||(this._index+=b,this.transition(d))}},a},this);